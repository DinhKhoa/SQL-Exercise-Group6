--CREATE DATABASE
CREATE DATABASE BTLGROUP6

USE BTLGROUP6

--CREATE TABLE
CREATE TABLE KEHANG
(
	MAKH CHAR(20) CONSTRAINT PK_KEHANG PRIMARY KEY,
	TANG INT CONSTRAINT CK_TANG CHECK(TANG > 0)
)

CREATE TABLE DANHMUC
(
	MADM CHAR(20) CONSTRAINT PK_DANHMUC PRIMARY KEY,
	TENDM NVARCHAR(30) NOT NULL
)

CREATE TABLE HANGHOA
(
	MAHH CHAR(20) CONSTRAINT PK_HANGHOA PRIMARY KEY,
	TENHH NVARCHAR(50) NOT NULL,
	DVT NVARCHAR(20) NOT NULL,
	DGN MONEY CONSTRAINT CK_DGN CHECK(DGN >= 0),
	MAKH CHAR(20) CONSTRAINT FK_HANGHOA_KEHANG FOREIGN KEY REFERENCES KEHANG(MAKH),
	MADM CHAR(20) CONSTRAINT FK_HANGHOA_DANHMUC FOREIGN KEY REFERENCES DANHMUC(MADM)
)

CREATE TABLE NHAPHANPHOI
(
	MANPP CHAR(20) CONSTRAINT PK_NHAPHANPHOI PRIMARY KEY,
	TENNPP NVARCHAR(50) NOT NULL,
	DIACHINPP NVARCHAR(50) NOT NULL,
	SDTNPP CHAR(11) CONSTRAINT CK_SDTNPP CHECK(LEN(SDTNPP) BETWEEN 9 AND 11 AND ISNUMERIC(SDTNPP) = 1)
)

CREATE TABLE NHAPHANG
(
	SOHD CHAR(20) NOT NULL,
	MAHH CHAR(20) CONSTRAINT FK_NHAPHANG_HANGHOA FOREIGN KEY(MAHH) REFERENCES HANGHOA(MAHH),
	MANPP CHAR(20) CONSTRAINT FK_NHAPHANG_NHAPHANPHOI FOREIGN KEY(MANPP) REFERENCES NHAPHANPHOI(MANPP), 
	CONSTRAINT PK_NHAPHANG PRIMARY KEY (SOHD, MAHH, MANPP),
	NGAYGIO DATETIME CONSTRAINT CK_NGAYGIO CHECK(NGAYGIO <= GETDATE()),
	SOLUONG INT CONSTRAINT CK_SOLUONG CHECK(SOLUONG >= 1),
	THANHTIEN MONEY CONSTRAINT CK_THANHTIEN CHECK(THANHTIEN >= 0)
)

--INSERT DATA
INSERT INTO DANHMUC(MADM, TENDM)
VALUES
	('DM001', N'BÁNH'),
	('DM002', N'NƯỚC NGỌT'),
	('DM003', N'SỮA'),
	('DM004', N'BIA'),
	('DM005', N'GIẤY VỆ SINH'),
	('DM006', N'KẸO'),
	('DM007', N'KEM ĐÁNH RĂNG'),
	('DM008', N'MÌ TÔM'),
	('DM009', N'XỊT THƠM PHÒNG')

INSERT INTO KEHANG(MAKH, TANG) 
VALUES 
	('KH101', '1'),
	('KH102', '1'),
	('KH103', '1'),
	('KH201', '2'),
	('KH202', '2'),
	('KH203', '2')

INSERT INTO HANGHOA(MAHH, TENHH, DVT, DGN, MAKH, MADM)
VALUES
	('HH001', N'MÌ HẢO HẢO', N'GÓI', 3000, 'KH101', 'DM008'),
	('HH002', N'MÌ SIU KAY', N'GÓI', 3800, 'KH101', 'DM008'),
	('HH003', N'MÌ LY MODERN', N'LY', 8000, 'KH101', 'DM008'),
	('HH004', N'SỮA VINAMILK', N'LỐC', 34000, 'KH102', 'DM003'),
	('HH005', N'BÁNH CHOCOPIE', N'HỘP', 36000, 'KH102', 'DM001'),
	('HH006', N'BÁNH CUSTAS', N'HỘP', 36000, 'KH102', 'DM001'),
	('HH007', N'KẸO CHUPA CHUPS', N'GÓI', 58000, 'KH102', 'DM006'),
	('HH008', N'BÁNH CEST BON', N'HỘP', 35000, 'KH102', 'DM001'),
	('HH009', N'COCA', N'THÙNG', 239000, 'KH103', 'DM002'),
	('HH010', N'PEPSI', N'THÙNG', 25000, 'KH103', 'DM002'),
	('HH011', N'BIA TIGER BẠC', N'THÙNG', 330000, 'KH103', 'DM004'),
	('HH012', N'BIA HUDA', N'THÙNG', 289000, 'KH103', 'DM004'),
	('HH013', N'KEM ĐÁNH RĂNG MAVIS', N'TUÝP', 75000, 'KH201', 'DM007'),
	('HH014', N'KEM ĐÁNH P/S THAN HOẠT TÍNH', N'TUÝP', 38000, 'KH201', 'DM007'),
	('HH015', N'GIẤY VỆ SINH PULPPY', N'BỊCH', 85000, 'KH202', 'DM005'),
	('HH016', N'GIẤY VỆ SINH BLESS YOU', N'BỊCH', 73900, 'KH202', 'DM005'),
	('HH017', N'XỊT PHÒNG GLADE', N'CHAI', 50000, 'KH203', 'DM009'),
	('HH018', N'XỊT PHÒNG THƠM SUMO', N'CHAI', 45000, 'KH203', 'DM009')

INSERT INTO NHAPHANPHOI(MANPP, TENNPP, DIACHINPP, SDTNPP) 
VALUES
	('NPP001', N'CÔNG TY CỔ PHẦN ACECOOK VIỆT NAM', N'QUẬN TÂN PHÚ, THÀNH PHỐ HỒ CHÍ MINH', '02838154067'), 
	('NPP002', N'CÔNG TY TNHH THỰC PHẨM ORION VINA', N'QUẬN BÌNH THẠNH, THÀNH PHỐ HỒ CHÍ MINH', '02835123420'), 
	('NPP003', N'CÔNG TY CỔ PHẦN SỮA VIỆT NAM', N'QUẬN 7, THÀNH PHỐ HỒ CHÍ MINH', '02854161226'), 
	('NPP004', N'CÔNG TY TNHH NHÀ MÁY BIA HUẾ', N'NGUYỄN SINH CUNG, THỪA THIÊN HUẾ', '02343850164'), 
	('NPP005', N'MARVIS VIỆT NAM', N'THANH XUÂN, HÀ NỘI', '0981281111'),
	('NPP006', N'CÔNG TY TNHH NGUYỄN MÌNH HOÀNG', N'HẢI CHÂU, ĐÀ NẴNG', '05113531532')

INSERT INTO NHAPHANG(SOHD, MAHH, MANPP, NGAYGIO, SOLUONG)
VALUES
	('HD001', 'HH006', 'NPP002', '2024-06-25', 12),
	('HD002', 'HH012', 'NPP004', '2024-04-27', 15),
	('HD003', 'HH014', 'NPP005', '2024-07-29', 30),
	('HD004', 'HH012', 'NPP004', '2024-09-12', 25),
	('HD005', 'HH004', 'NPP003', '2024-10-11', 20),
	('HD006', 'HH005', 'NPP004', '2024-07-31', 18),
	('HD007', 'HH001', 'NPP001', '2024-08-17', 30),
	('HD008', 'HH011', 'NPP004', '2024-06-23', 15),
	('HD009', 'HH007', 'NPP001', '2024-01-30', 10),
	('HD010', 'HH018', 'NPP003', '2024-10-10', 20),
	('HD011', 'HH008', 'NPP002', '2024-09-07', 14),
	('HD012', 'HH011', 'NPP004', '2024-04-10', 20)

UPDATE NHAPHANG
SET THANHTIEN = NH.SOLUONG * HH.DGN
FROM NHAPHANG NH JOIN HANGHOA HH 
ON NH.MAHH = HH.MAHH

--SELECT
SELECT * FROM HANGHOA
SELECT * FROM KEHANG
SELECT * FROM DANHMUC
SELECT * FROM NHAPHANPHOI
SELECT * FROM NHAPHANG
